# Gitコマンドについて

目次

- [Gitコマンドについて](#gitコマンドについて)
  - [リンク集](#リンク集)
  - [読んでおきたい記事](#読んでおきたい記事)
  - [次調べたいコマンドリスト](#次調べたいコマンドリスト)
  - [その他調べてみたいこと](#その他調べてみたいこと)
  - [ToDo](#todo)
  - [HEAD](#head)
  - [origin](#origin)
  - [ローカルとリモートの関係](#ローカルとリモートの関係)
  - [基本的な操作](#基本的な操作)
  - [新しいリポジトリを作成](#新しいリポジトリを作成)
  - [直近のコミットを修正しプッシュする](#直近のコミットを修正しプッシュする)
  - [競合のパターン](#競合のパターン)
  - [プルする前に事前に競合しないか確認](#プルする前に事前に競合しないか確認)
  - [競合が発生した場合にローカルをリモートのもので上書き](#競合が発生した場合にローカルをリモートのもので上書き)
  - [プッシュ 及び プルで競合が発生した場合](#プッシュ-及び-プルで競合が発生した場合)
  - [タグのの追加 及び 削除](#タグのの追加-及び-削除)
  - [Git コマンドでカレントディレクトリがローカルリポジトリ内にある場合](#git-コマンドでカレントディレクトリがローカルリポジトリ内にある場合)
  - [git reset 等で誤ってコミットを削除してしまった場合](#git-reset-等で誤ってコミットを削除してしまった場合)
  - [新しいコミットで HEAD が移動した場合](#新しいコミットで-head-が移動した場合)
  - [誤ってブランチを削除してしまった場合](#誤ってブランチを削除してしまった場合)
  - [git reset](#git-reset)
  - [git add](#git-add)
  - [git cloen](#git-cloen)
  - [git branch](#git-branch)
  - [git log](#git-log)
  - [git checkout](#git-checkout)
  - [git push](#git-push)
  - [git fetch](#git-fetch)
  - [git status](#git-status)
  - [git reflog](#git-reflog)

## リンク集

| タイトル         | URL                                                                   |
| :--------------- | :-------------------------------------------------------------------- |
| Git Reference    | <https://git-scm.com/docs>                                            |
| GIT チートシート | <https://training.github.com/downloads/ja/github-git-cheat-sheet.pdf> |
| Git Hub Docs     | <https://docs.github.com/ja>                                          |

## 読んでおきたい記事

| タイトル                                   | URL                                                    |
| :----------------------------------------- | :----------------------------------------------------- |
| 忘れやすい人のための git diff チートシート | <https://qiita.com/shibukk/items/8c9362a5bd399b9c56be> |
| Gitチートシート                            | <https://qiita.com/ktarow/items/1d8c8ae698a88b1d6f0f>  |
| Gitでよく使うコマンド一覧                  | <https://qiita.com/uhooi/items/c26c7c1beb5b36e7418e>   |

## 次調べたいコマンドリスト

| コマンド  | 簡略的な内容                               |
| :-------- | :----------------------------------------- |
| git clone | 既存のリモートリポジトリをローカルにDLする |

## その他調べてみたいこと

- 現在、特になし

## ToDo

- [ ] コマンドを調べる
- [ ] シチュエーションごとのコマンドを記載

## HEAD

HEAD は Git リポジトリにおいて特別なリファレンスで、現在チェックアウトされているブランチまたはコミットを指します。通常、HEAD は現在作業中のブランチの最新のコミットを指しています。

- `現在のブランチ`: 通常、HEAD は現在チェックアウトされているブランチを指しています。例えば、main ブランチをチェックアウトしている場合、HEAD は main ブランチの最新のコミットを指します。
- `コミット間の移動`: HEAD を使って他のブランチやコミットに移動できます。例えば、git checkout `[branch]` コマンドを使うと、HEAD はそのブランチの最新のコミットを指します。
- `デタッチドヘッド`: 具体的なコミットをチェックアウトした場合（例えば、git checkout `[commit-hash]`）、HEAD はその特定のコミットを指し、デタッチドヘッド状態（detached HEAD state）となります。この場合、HEAD はブランチを指さず、特定のコミットを指します。

## origin

origin は、Git リポジトリでよく使用されるデフォルトのリモートリポジトリの名前です。Git では、複数のリモートリポジトリを管理でき、各リモートリポジトリには名前（エイリアス）が付けられます。origin は、そのうち最初に設定されるリモートリポジトリに対して自動的に割り当てられるエイリアスです。

## ローカルとリモートの関係

- `ローカルリポジトリ`:
開発者が実際に作業を行う場所です。ローカルリポジトリには作業ディレクトリ、ステージングエリア、ローカルの Git データベース（.git ディレクトリ）が含まれます。

- `リモートリポジトリ`:
共同作業者と共有するためのリポジトリです。リモートリポジトリは通常 GitHub、GitLab、Bitbucket などのリモートホスティングサービスにホストされます。

ローカルリポジトリで変更を行い、それをリモートリポジトリに反映させることで、他の開発者とコードを共有し、共同作業を進めることができます。この流れにより、各開発者は独立して作業を行いながらも、チーム全体の作業を同期させることができます。

## 基本的な操作

基本的な考え方として、Git ではローカルリポジトリで変更を行い、その変更をリモートリポジトリに反映させるという流れになります。以下に、一般的な作業フローを示します。

リモートリポジトリを `clone` してファイル編集・追加後、`staging`, `commit`, `push` する方法

```shell
# リモートリポジトリをクローンするディレクトリに移動
cd /path/directory_name

# 既存のリモートリポジトリをクローンする
git clone https://github.com/KR4005/Knowledge.git

# 全体の変更をステージング
git add -A

# ステージングされたファイル 及び ディレクトリをファイル
git status

# ワークツリーとステージングエリアの間の変更を表示
git diff

# コミットメッセージを付けてコミット ( git commit で編集モードでメッセージを入力可 )
git commit -m "commit-message"

# リモートリポジトリのブランチにプッシュ
git push origin [branch-name]
```

## 新しいリポジトリを作成

```shell
# 新しいリポジトリを作成したいディレクトリを作成
mkdir my-new-repo
cd my-new-repo

# Gitリポジトリを初期化
git init

# ファイルを追加して初期コミット
echo "# My New Repo" >> README.md
git add --all
git commit -m "initial commit"

# または空のコミットを作成
git commit --allow-empty -m "initial commit"

# 初期プッシュ
git push origin main
```

## 直近のコミットを修正しプッシュする

```shell
# すべての変更をステージングエリアに追加する
git add --all

# コミットを修正する
git commit --amend

# リモートリポジトリに変更を強制プッシュする
git push --force origin <branch-name>
```

- git commit --amend を使用して直近のコミットを修正する場合、リモートリポジトリに既にプッシュされているコミットを修正する場合は、git push --force を使用して強制プッシュする必要があります。
- 強制プッシュはリモートリポジトリの履歴を変更するため、他の開発者との協力プロジェクトでは慎重に使用する必要があります。可能であれば、直近のコミットを修正する前に他の開発者と相談しましょう。

## 競合のパターン

競合は、主に git pull や git push の操作中に発生することがあります。以下に、それぞれの操作における競合の発生条件を説明します。

1. プル（git pull）:

  リモートリポジトリの変更を取得して、ローカルの変更とマージするときに競合が発生することがあります。
  例えば、他の開発者が同じファイルを変更し、その変更をリモートリポジトリにプッシュした場合、ローカルの変更と競合する可能性があります。

1. プッシュ（git push）:

  リモートリポジトリに変更をプッシュしようとするときに、リモートリポジトリの履歴と競合することがあります。
  例えば、他の開発者が同じブランチに変更をプッシュし、それがローカルの変更と競合する場合、競合が発生します。

競合が発生した場合、Gitは競合が解決されるまで操作を中断します。開発者は競合を手動で解決し、その後に操作を継続する必要があります。競合は、協力プロジェクトで同時に複数の開発者が同じファイルを変更し、それらの変更が競合する場合に特によく発生します。

## プルする前に事前に競合しないか確認

```shell
# リモートの変更を取得
git fetch origin

# 差分を確認
git diff HEAD..origin/main
```

## 競合が発生した場合にローカルをリモートのもので上書き

```shell
git fetch origin
git reset --hard origin/main
```

これにより、リモートの main ブランチの最新のコミットにローカルの main ブランチをリセットし、すべての変更がリモートのもので上書きされます。ただし、注意点として、この操作はローカルの変更を完全に削除し、リセットされた状態になるため、変更が失われる可能性があります。必要ならば、この操作を実行する前に変更を保存することをお勧めします。

## プッシュ 及び プルで競合が発生した場合

```shell
git reset --hard HEAD@{1}
```

競合が発生する直前のコミットIDを知っている場合、ログの確認は不要です。このコマンドを実行することで、競合が発生する前の状態にローカルのブランチを戻すことができます。

## タグのの追加 及び 削除

```shell
# タグのローカルへの付け方
git tag -a v1.0 -m "Version 1.0"

# またはタグ無し
git tag v1.0

# タグのリモートへの反映
git push origin v1.0
```

```shell
# タグの削除
git tag -d v1.0

# 削除したタグのリモートへの反映
git push origin :refs/tags/v1.0
```

## Git コマンドでカレントディレクトリがローカルリポジトリ内にある場合

ブランチ名を省略して現在のブランチに対して操作を行うコマンドは、次のようなものがあります

```shell
# ブランチ名を省略した場合、現在のブランチが変更されません。代わりに、以前にチェックアウトしたブランチに戻ります。
git checkout

# ブランチ名を省略した場合、現在のブランチを表示
git branch

# ブランチ名を省略した場合、現在のブランチをマージ先として使用します。
git merge
```

これらのコマンドをブランチ名を省略して実行することで、現在のブランチに対する操作を行うことができます。ただし、これらのコマンドにはそれぞれ異なる動作がありますので、目的に応じて適切なものを選択してください。

## git reset 等で誤ってコミットを削除してしまった場合

```shell
# 間違ってコミットを取り消した場合、以前の状態に戻す
git reflog
# 取り消したコミットのコミットIDを確認し、復元する
git reset --hard <取り消したコミットのコミットID>
```

## 新しいコミットで HEAD が移動した場合

```shell
# HEAD の移動履歴を表示
git reflog
# 間違ってHEADを移動させた場合、以前の位置に戻す
git reset --hard HEAD@{1}
```

## 誤ってブランチを削除してしまった場合

```shell
# 間違って削除したブランチを復元する例
git reflog
# 削除したブランチのコミットIDを確認し、復元する
git checkout -b <復元したいブランチ名> <削除したブランチのコミットID>
```

## git reset

```shell
# コミットされていない、ステージニングされた変更をワーキングツリーに戻す
git reset

# コミットを取り消すが、変更はステージングされたまま
git reset --soft

# コミットを取り消し、変更をステージングから解除
git reset --mixed

# すべての変更が取り消され、ワークツリーが完全にクリーンな状態に
git reset --hard
```

git reset コマンドでコミットハッシュを指定しない場合は、デフォルトで現在の HEAD をターゲットにして動作します。つまり、直近のコミットが指定されます。

## git add

```shell
# どのファイルがステージングされるかを表示
git add -n

# 対話型で部分的にファイルを選択してステージング
git add -p

# 対話型モードでファイルを選択してステージング
git add -i
```

## git cloen

```shell
# 既存のリポジトリをクローンする
git clone [RepositoryURL]
```

デフォルトでカレントディレクトリに保存される

## git branch

```shell
# 現在のリポジトリ上のすべてのローカルブランチを一覧で表示
git branch

# 新規ブランチを作成
git branch [BranchName]

# 指定されたブランチを削除
git branch -d [BranchName]

# リモートブランチを含めた全てのブランチを一覧で表示
git branch -a

# リモートブランチを一覧で表示
git branch -r
```

## git log

```shell
# 最新のコミット情報を表示
git log　-1

# 各ブランチのツリー構造を確認
git log  --all --graph --decorate --oneline
```

## git checkout

```shell
# 指定されたブランチに切り替え
git checkout [BranchName]
```

## git push

```shell
# 現在のブランチをリモートにプッシュ
git push

# 特定のブランチをリモートにプッシュ
git push origin [branch-name]

# 強制的にプッシュ
git push --force

<<COMMENT
通常は競合を防ぐために慎重に使用すべきです。このオプションは、リモートブランチの履歴を書き換えるため、他の開発者に影響を与える可能性があります。
COMMENT

# 新しいリモートブランチを作成してプッシュ
git push origin [local-branch]:[remote-branch]

<<COMMENT
強制的にプッシュします。通常は競合を防ぐために慎重に使用すべきです。このオプションは、リモートブランチの履歴を書き換えるため、他の開発者に影響を与える可能性があります。
COMMENT

# すべてのローカルタグをリモートにプッシュ
git push --tags

# リモートリポジトリのブランチを削除
git push origin --delete [branch-name]
```

```shell
git checkout -b feature-branch
git push -u origin feature-branch
```

## git fetch

git fetch は、リモートリポジトリの最新の変更をローカルに取り込むためのコマンドです。git fetch を使用することで、リモートリポジトリのブランチやタグの最新の状態を取得し、ローカルリポジトリに反映させることができますが、これによりローカルの作業ツリーやブランチは変更されません。

```shell
git fetch
```

## git status

```shell
git status
```

このコマンドは、ステージングされた変更や未追跡のファイルを含む、リポジトリの現在の状態を表示します。ステージングされた変更は "Staged for commit" として表示されます。

## git reflog

```shell
git reflog
```

git reflog コマンドは、Git リポジトリ内の参照のログを表示します。主に以下の目的で使用されます。

- HEAD の移動履歴の表示: git checkout や git reset などによって HEAD が移動した履歴を確認できます。
- ブランチの変更履歴の表示: ブランチが変更された履歴を確認できます。
- 操作の履歴の表示: コミット、マージ、リベースなどの操作が行われた履歴を確認できます。
- git reflog コマンドは、主にリポジトリ内での作業履歴のトラッキングや、誤って削除したコミットやブランチの復元

などに役立ちます。リポジトリ内での変更や操作を追跡するための便利なツールですが、長期間にわたって過去の操作を保持するわけではないため、適切なタイミングでコミットやブランチのバックアップを取ることが重要です。

git reflog と git log の主な違いは次の通りです。

1. 対象とする履歴の種類:

   - git log: コミット履歴を表示します。主にリポジトリ内で行われたコミットのログを表示するために使用されます。
   - git reflog: 参照のログを表示します。主に HEAD の移動、ブランチの変更、操作の履歴など、参照に関連するすべての変更を表示します。

1. 表示される内容:

   - git log: コミットのハッシュ、作者、コミットメッセージなどのコミットに関する情報を表示します。
   - git reflog: HEAD の移動、ブランチの変更、操作（コミット、マージ、リベースなど）など、リポジトリ内での参照の変更に関する情報を表示します。

1. 使用目的:

   - git log: 主にリポジトリの履歴を確認し、変更やコミットの詳細を追跡するために使用されます。
   - git reflog: 主にリポジトリ内での操作の追跡や、HEAD の移動やブランチの変更の履歴を確認するために使用されます。特に、間違って削除したコミットやブランチの復元に役立ちます。
